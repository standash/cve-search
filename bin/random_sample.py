import os,csv,sys,random,argparse
runPath = os.path.dirname(os.path.realpath(__file__))
sys.path.append(os.path.join(runPath, ".."))

import lib.Query as query

if __name__ == "__main__":
    arg_parser = argparse.ArgumentParser()
    arg_parser.add_argument("-i", type=str, help="input")
    
    args = arg_parser.parse_args()
    
    in_filename = args.i
    writer = csv.writer(sys.stdout, delimiter=",")

    total_records = []
    if (os.path.exists(in_filename)):
        with open(in_filename, "r")	as _file:
            for line in _file:
                result = query.product_search(product_pattern=line.rstrip("\n"))
                total_records.extend(result)
        random_sample_indices = random.sample(range(1,len(total_records)), 20)
        for index in random_sample_indices:
            item = total_records[index]
            writer.writerow([item["id"], item["summary"]])
    else:
        print("ERROR: the input file does not exist", file=sys.stderr)